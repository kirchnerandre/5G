
#include <stdio.h>

#include "FourierTransform.h"


namespace
{
    constexpr float _max_error = 0.000100f;

    bool compare(Data::DATAS_T& Computed, Data::DATAS_T& Expected)
    {
        if (Computed.size() != Expected.size())
        {
            fprintf(stderr, "%s:%d:%s: Different buffer sizes\n", __FILE__, __LINE__, __FUNCTION__);
            return false;
        }

        for (size_t i = 0u; i < Computed.size(); i++)
        {
            if ((Computed[i].Real      > Expected[i].Real      + _max_error) || (Computed[i].Real      < Expected[i].Real      - _max_error)
             || (Computed[i].Imaginary > Expected[i].Imaginary + _max_error) || (Computed[i].Imaginary < Expected[i].Imaginary - _max_error))
            {
                fprintf(stderr, "%s:%d:%s: Incorrected value computed\n", __FILE__, __LINE__, __FUNCTION__);
                return false;
            }
            else if (Computed[i].TimeFrequency != Expected[i].TimeFrequency)
            {
                fprintf(stderr, "%s:%d:%s: Incorrected value computed\n", __FILE__, __LINE__, __FUNCTION__);
                return false;
            }
        }

        return true;
    }
}


bool test_forward()
{
    Data::DATAS_T input     = { {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   1.000000f }, {   0.000000f,   0.000000f,   2.000000f }, {   0.000000f,   0.000000f,   3.000000f },
                                {   0.000000f,   0.000000f,   4.000000f }, {   0.000000f,   0.000000f,   5.000000f }, {   0.000000f,   0.000000f,   6.000000f }, {   0.000000f,   0.000000f,   7.000000f },
                                {   1.000000f,   0.000000f,   8.000000f }, {   1.000000f,   0.000000f,   9.000000f }, {   1.000000f,   0.000000f,  10.000000f }, {   1.000000f,   0.000000f,  11.000000f },
                                {   1.000000f,   0.000000f,  12.000000f }, {   1.000000f,   0.000000f,  13.000000f }, {   1.000000f,   0.000000f,  14.000000f }, {   1.000000f,   0.000000f,  15.000000f },
                                {   1.000000f,   0.000000f,  16.000000f }, {   1.000000f,   0.000000f,  17.000000f }, {   1.000000f,   0.000000f,  18.000000f }, {   1.000000f,   0.000000f,  19.000000f },
                                {   1.000000f,   0.000000f,  20.000000f }, {   1.000000f,   0.000000f,  21.000000f }, {   1.000000f,   0.000000f,  22.000000f }, {   1.000000f,   0.000000f,  23.000000f },
                                {   0.000000f,   0.000000f,  24.000000f }, {   0.000000f,   0.000000f,  25.000000f }, {   0.000000f,   0.000000f,  26.000000f }, {   0.000000f,   0.000000f,  27.000000f },
                                {   0.000000f,   0.000000f,  28.000000f }, {   0.000000f,   0.000000f,  29.000000f }, {   0.000000f,   0.000000f,  30.000000f }, {   0.000000f,   0.000000f,  31.000000f } };

    Data::DATAS_T expected  = { {  16.000000f,   0.000000f,   0.000000f }, { -10.153170f,  -1.000000f,   1.000000f }, {   0.000000f,   0.000000f,   2.000000f }, {   3.296557f,   1.000000f,   3.000000f },
                                {   0.000000f,   0.000000f,   4.000000f }, {  -1.870869f,  -1.000000f,   5.000000f }, {   0.000000f,   0.000000f,   6.000000f }, {   1.218505f,   1.000000f,   7.000000f },
                                {   0.000000f,   0.000000f,   8.000000f }, {  -0.820679f,  -1.000000f,   9.000000f }, {   0.000000f,   0.000000f,  10.000000f }, {   0.534513f,   1.000000f,  11.000000f },
                                {   0.000000f,   0.000000f,  12.000000f }, {  -0.303348f,  -1.000000f,  13.000000f }, {   0.000000f,   0.000000f,  14.000000f }, {   0.098489f,   1.000000f,  15.000000f },
                                {   0.000000f,   0.000000f,  16.000000f }, {   0.098487f,  -1.000000f,  17.000000f }, {   0.000000f,   0.000000f,  18.000000f }, {  -0.303355f,   1.000000f,  19.000000f },
                                {   0.000000f,   0.000000f,  20.000000f }, {   0.534504f,  -1.000000f,  21.000000f }, {   0.000000f,   0.000000f,  22.000000f }, {  -0.820671f,   1.000000f,  23.000000f },
                                {   0.000000f,   0.000000f,  24.000000f }, {   1.218513f,  -1.000000f,  25.000000f }, {   0.000000f,   0.000000f,  26.000000f }, {  -1.870865f,   1.000000f,  27.000000f },
                                {   0.000000f,   0.000000f,  28.000000f }, {   3.296546f,  -1.000000f,  29.000000f }, {   0.000000f,   0.000000f,  30.000000f }, { -10.153172f,   1.000000f,  31.000000f } };

    Data::DATAS_T output    = { {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f } };

    if (!FourierTransform::forward(output, input))
    {
        fprintf(stderr, "%s:%d:%s: Failed to compute forward Fourier Transform\n", __FILE__, __LINE__, __FUNCTION__);
        return false;
    }

    if (!compare(output, expected))
    {
        fprintf(stderr, "%s:%d:%s: Incorrect computed forward Fourier Transform\n", __FILE__, __LINE__, __FUNCTION__);
        return false;
    }

    return true;
}


bool test_backward()
{
    Data::DATAS_T input     = { {  16.000000f,   0.000000f,   0.000000f }, { -10.153170f,  -1.000000f,   1.000000f }, {   0.000000f,   0.000000f,   2.000000f }, {   3.296557f,   1.000000f,   3.000000f },
                                {   0.000000f,   0.000000f,   4.000000f }, {  -1.870869f,  -1.000000f,   5.000000f }, {   0.000000f,   0.000000f,   6.000000f }, {   1.218505f,   1.000000f,   7.000000f },
                                {   0.000000f,   0.000000f,   8.000000f }, {  -0.820679f,  -1.000000f,   9.000000f }, {   0.000000f,   0.000000f,  10.000000f }, {   0.534513f,   1.000000f,  11.000000f },
                                {   0.000000f,   0.000000f,  12.000000f }, {  -0.303348f,  -1.000000f,  13.000000f }, {   0.000000f,   0.000000f,  14.000000f }, {   0.098489f,   1.000000f,  15.000000f },
                                {   0.000000f,   0.000000f,  16.000000f }, {   0.098487f,  -1.000000f,  17.000000f }, {   0.000000f,   0.000000f,  18.000000f }, {  -0.303355f,   1.000000f,  19.000000f },
                                {   0.000000f,   0.000000f,  20.000000f }, {   0.534504f,  -1.000000f,  21.000000f }, {   0.000000f,   0.000000f,  22.000000f }, {  -0.820671f,   1.000000f,  23.000000f },
                                {   0.000000f,   0.000000f,  24.000000f }, {   1.218513f,  -1.000000f,  25.000000f }, {   0.000000f,   0.000000f,  26.000000f }, {  -1.870865f,   1.000000f,  27.000000f },
                                {   0.000000f,   0.000000f,  28.000000f }, {   3.296546f,  -1.000000f,  29.000000f }, {   0.000000f,   0.000000f,  30.000000f }, { -10.153172f,   1.000000f,  31.000000f } };

    Data::DATAS_T expected  = { {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   1.000000f }, {   0.000000f,   0.000000f,   2.000000f }, {   0.000000f,   0.000000f,   3.000000f },
                                {   0.000000f,   0.000000f,   4.000000f }, {   0.000000f,   0.000000f,   5.000000f }, {   0.000000f,   0.000000f,   6.000000f }, {   0.000000f,   0.000000f,   7.000000f },
                                {   1.000000f,   0.000000f,   8.000000f }, {   1.000000f,   0.000000f,   9.000000f }, {   1.000000f,   0.000000f,  10.000000f }, {   1.000000f,   0.000000f,  11.000000f },
                                {   1.000000f,   0.000000f,  12.000000f }, {   1.000000f,   0.000000f,  13.000000f }, {   1.000000f,   0.000000f,  14.000000f }, {   1.000000f,   0.000000f,  15.000000f },
                                {   1.000000f,   0.000000f,  16.000000f }, {   1.000000f,   0.000000f,  17.000000f }, {   1.000000f,   0.000000f,  18.000000f }, {   1.000000f,   0.000000f,  19.000000f },
                                {   1.000000f,   0.000000f,  20.000000f }, {   1.000000f,   0.000000f,  21.000000f }, {   1.000000f,   0.000000f,  22.000000f }, {   1.000000f,   0.000000f,  23.000000f },
                                {   0.000000f,   0.000000f,  24.000000f }, {   0.000000f,   0.000000f,  25.000000f }, {   0.000000f,   0.000000f,  26.000000f }, {   0.000000f,   0.000000f,  27.000000f },
                                {   0.000000f,   0.000000f,  28.000000f }, {   0.000000f,   0.000000f,  29.000000f }, {   0.000000f,   0.000000f,  30.000000f }, {   0.000000f,   0.000000f,  31.000000f } };

    Data::DATAS_T output    = { {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f },
                                {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f }, {   0.000000f,   0.000000f,   0.000000f } };

    if (!FourierTransform::backward(output, input))
    {
        fprintf(stderr, "%s:%d:%s: Failed to compute backward Fourier Transform\n", __FILE__, __LINE__, __FUNCTION__);
        return false;
    }

    if (!compare(output, expected))
    {
        fprintf(stderr, "%s:%d:%s: Incorrect computed backward Fourier Transform\n", __FILE__, __LINE__, __FUNCTION__);
        return false;
    }

    return true;
}


int main(int argc, char** argv)
{
    if (!test_forward())
    {
        fprintf(stderr, "%s:%d:%s: Test failed\n", __FILE__, __LINE__, __FUNCTION__);
        return -1;
    }

    if (!test_backward())
    {
        fprintf(stderr, "%s:%d:%s: Test failed\n", __FILE__, __LINE__, __FUNCTION__);
        return -1;
    }

    return 0;
}
